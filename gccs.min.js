#!/bin/env node
/*
 MIT https://github.com/duzun/gccs/blob/master/LICENSE
 @version  1.1.0
*/
(function(n,h){function k(a,b){var d={};a&&"object"==typeof a&&!l(a)&&(d=a,a=d.js_code);if(l(a))return q(a,function(a,c){if(a)return b(a);d.js_code=c;k(d,b)});Buffer.isBuffer(a)&&(a=a.toString(n));d.js_code=a;var c=Object.assign({output_info:"compiled_code",output_format:"text",compilation_level:"SIMPLE_OPTIMIZATIONS",warning_level:"QUIET"},d),f=443,e=u;!1===c.https&&(f=80,e=v);delete c.https;c=w.stringify(c);f=e.request({hostname:"closure-compiler.appspot.com",port:f,path:"/compile",method:"POST",
headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":Buffer.byteLength(c)}},function(a){q(a,function(c,d){b(c,d&&d.toString(n),a)})});f.on("error",b);f.write(c);f.end();return f}function r(a,b,d){d||"function"!=typeof b||(d=b,b=void 0);a=a!==h?l(a)?a:t.createReadStream(a):process.stdin;if(b){if("string"==typeof b||l(b)){var c=b;b=void 0}else b.out_file&&(c=b.out_file,delete b.out_file);c&&c===h&&(c=process.stdout)}return k(Object.assign({},b,{js_code:a}),function(a,b){if(a)return d(a);
c?(l(c)||(c=t.createWriteStream(c)),c.write(b,n,function(a){d(a,b)}),c._isStdio||c.end()):d(a,b)})}function l(a){return null!==a&&"object"===typeof a&&"function"===typeof a.pipe}function q(a,b){var d=[];a.on("data",function(a){d.push(a)});a.on("end",function(){b(null,d=Buffer.concat(d),a)});a.on("error",b);return a}function p(a){var b="Usage:\n    "+m.basename(process.argv[1],".js")+' [ <in_file> [ <out_file> ] ]\n\n    If <out_file> is omitted, out_file = in_file.min.js\n    If <in_file> == "-", stdin is used (<out_file> defaults to "-").\n    If <out_file> == "-", stdout is used.\n    If <in_file> and <out_file> are both omitted, they both default to "-".\n';
if(a)a.write(b);else return b}var v=require("http"),u=require("https"),t=require("fs"),m=require("path"),w=require("querystring");if(module.parent)k.file=r,k.cli_usage=p,module.exports=k;else{var e=process.argv[2],g=process.argv[3];"--help"===e&&(p(process.stdout),process.exit(0));e&&e!==h?g||(g=m.join(m.dirname(e),m.basename(e,".js")+".min.js")):(e=h,g||(g=h));r(e,g,function(a){a&&(console.error(a),p(process.stderr),process.exit(2));g!=h&&console.log("\u001b[32m%s\u001b[0m",g)})}})("utf8","-");
