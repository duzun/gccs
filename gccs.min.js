#!/usr/bin/env node
(function(r,g){function h(a,l){var c={};a&&"object"==typeof a&&!m(a)&&(c=a,a=c.js_code);if(m(a))return u(a,function(a,b){if(a)return l(a);c.js_code=b;h(c,l)});Buffer.isBuffer(a)&&(a=a.toString(r));var d=a.match(/^#!.{3,}/);c.js_code=a;var b=Object.assign({warning_level:"QUIET",compilation_level:"SIMPLE_OPTIMIZATIONS"},c,{output_info:"compiled_code",output_format:"text"}),f=443,e=x;"https"in b&&(b.https||(f=80,e=y),delete b.https);b=z.stringify(b);f=e.request({hostname:"closure-compiler.appspot.com",
port:f,path:"/compile",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":Buffer.byteLength(b)}},function(a){u(a,function(b,c){c&&(c=c.toString(r));d&&(c=d[0]+"\n"+c);l(b,c,a)})});f.on("error",l);f.write(b);f.end();return f}function v(a,b,c){c||"function"!=typeof b||(c=b,b=void 0);a=a!==g?m(a)?a:w.createReadStream(a):process.stdin;if(b){if("string"==typeof b||m(b)){var d=b;b=void 0}else b.out_file&&(d=b.out_file,delete b.out_file);d&&d===g&&(d=process.stdout)}return h(Object.assign({},
b,{js_code:a}),function(a,b){if(a)return c(a);d?(m(d)||(d=w.createWriteStream(d)),d.write(b,r,function(a){c(a,b)}),d._isStdio||d.end()):c(a,b)})}function m(a){return null!==a&&"object"===typeof a&&"function"===typeof a.pipe}function u(a,b){var c=[];a.on("data",function(a){c.push(a)});a.on("end",function(){b(null,c=Buffer.concat(c),a)});a.on("error",b);return a}function A(a){if("string"==typeof a)try{return JSON.parse(a)}catch(l){}return a}function t(a){var b="Usage:\n    "+p.basename(process.argv[1],
".js")+' [ <in_file> [ <out_file> ] ]\n\n    If <out_file> is omitted, out_file = in_file.min.js\n    If <in_file> == "-", stdin is used (<out_file> defaults to "-").\n    If <out_file> == "-", stdout is used.\n    If <in_file> and <out_file> are both omitted, they both default to "-".\n';if(a)a.write(b);else return b}var y=require("http"),x=require("https"),w=require("fs"),p=require("path"),z=require("querystring");h.VERSION="1.3.0";if(module.parent)h.file=v,h.cli_usage=t,module.exports=h;else{for(var k=
{},q=process.argv,n=2,b;(b=q[n])&&"--"==b.slice(0,2);){++n;if("--"===b)break;b=b.slice(2);switch(b){case "help":t(process.stdout);process.exit(0);break;default:k[b]=A(q[n++])}}b=q[n]||k.in_file;var e=q[n+1]||k.out_file;b&&b!==g?e||(e=p.join(p.dirname(b),p.basename(b,".js")+".min.js")):(b=g,e||(e=g));k.out_file=e;delete k.in_file;v(b,k,function(a){a&&(console.error(a),t(process.stderr),process.exit(2));e!=g&&console.log("\u001b[32m%s\u001b[0m",e)})}})("utf8","-");
