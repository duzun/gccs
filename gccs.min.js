#!/bin/env node
(function(q,f){function h(a,k){var d={};a&&"object"==typeof a&&!l(a)&&(d=a,a=d.js_code);if(l(a))return t(a,function(a,b){if(a)return k(a);d.js_code=b;h(d,k)});Buffer.isBuffer(a)&&(a=a.toString(q));d.js_code=a;var c=Object.assign({warning_level:"QUIET",compilation_level:"SIMPLE_OPTIMIZATIONS"},d,{output_info:"compiled_code",output_format:"text"}),b=443,e=w;"https"in c&&(c.https||(b=80,e=x),delete c.https);c=y.stringify(c);b=e.request({hostname:"closure-compiler.appspot.com",port:b,path:"/compile",
method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":Buffer.byteLength(c)}},function(a){t(a,function(b,c){k(b,c&&c.toString(q),a)})});b.on("error",k);b.write(c);b.end();return b}function u(a,b,d){d||"function"!=typeof b||(d=b,b=void 0);a=a!==f?l(a)?a:v.createReadStream(a):process.stdin;if(b){if("string"==typeof b||l(b)){var c=b;b=void 0}else b.out_file&&(c=b.out_file,delete b.out_file);c&&c===f&&(c=process.stdout)}return h(Object.assign({},b,{js_code:a}),function(a,
b){if(a)return d(a);c?(l(c)||(c=v.createWriteStream(c)),c.write(b,q,function(a){d(a,b)}),c._isStdio||c.end()):d(a,b)})}function l(a){return null!==a&&"object"===typeof a&&"function"===typeof a.pipe}function t(a,b){var d=[];a.on("data",function(a){d.push(a)});a.on("end",function(){b(null,d=Buffer.concat(d),a)});a.on("error",b);return a}function z(a){if("string"==typeof a)try{return JSON.parse(a)}catch(k){}return a}function r(a){var b="Usage:\n    "+n.basename(process.argv[1],".js")+' [ <in_file> [ <out_file> ] ]\n\n    If <out_file> is omitted, out_file = in_file.min.js\n    If <in_file> == "-", stdin is used (<out_file> defaults to "-").\n    If <out_file> == "-", stdout is used.\n    If <in_file> and <out_file> are both omitted, they both default to "-".\n';
if(a)a.write(b);else return b}var x=require("http"),w=require("https"),v=require("fs"),n=require("path"),y=require("querystring");if(module.parent)h.file=u,h.cli_usage=r,module.exports=h;else{for(var g={},p=process.argv,m=2,b;(b=p[m])&&"--"==b.slice(0,2);){++m;if("--"===b)break;b=b.slice(2);switch(b){case "help":r(process.stdout);process.exit(0);break;default:g[b]=z(p[m++])}}b=p[m]||g.in_file;var e=p[m+1]||g.out_file;b&&b!==f?e||(e=n.join(n.dirname(b),n.basename(b,".js")+".min.js")):(b=f,e||(e=f));
g.out_file=e;delete g.in_file;u(b,g,function(a){a&&(console.error(a),r(process.stderr),process.exit(2));e!=f&&console.log("\u001b[32m%s\u001b[0m",e)})}})("utf8","-");
